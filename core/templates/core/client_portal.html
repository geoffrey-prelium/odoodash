<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{ page_title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body class="bg-slate-50 font-sans text-slate-800">

    <header class="bg-white shadow-sm p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold text-indigo-600">Mon Tableau de Bord</h1>
            <div class="text-sm">
                Bonjour, <strong>{{ user.first_name|default:user.username }}</strong>
                <form method="post" action="{% url 'logout' %}" class="inline ml-4">
                    {% csrf_token %}
                    <button type="submit" class="text-red-500 hover:underline">Se déconnecter</button>
                </form>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-6">
        
        <div class="mb-8">
            <h2 class="text-3xl font-bold text-slate-700">{{ client.client_name }}</h2>
            <p class="text-slate-500">État de santé de votre instance Odoo</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <p class="text-sm text-slate-500 uppercase font-semibold">Version Odoo</p>
                <p class="text-3xl font-bold text-indigo-600 mt-2">{{ kpis|get_item:'version odoo'|default:'-' }}</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <p class="text-sm text-slate-500 uppercase font-semibold">Utilisateurs Actifs</p>
                <p class="text-3xl font-bold text-emerald-600 mt-2">{{ kpis|get_item:'nb utilisateurs actifs'|default:'0' }}</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <p class="text-sm text-slate-500 uppercase font-semibold">À Facturer</p>
                <p class="text-3xl font-bold text-orange-500 mt-2">{{ kpis|get_item:'nombre de commandes à facturer'|default:'0' }}</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h3 class="text-lg font-semibold mb-4">Évolution de l'usage</h3>
                <div id="chart-users"></div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h3 class="text-lg font-semibold mb-4">Performance Technique</h3>
                <div class="flex items-center justify-center h-64 text-slate-400">
                    (Autre graphique à venir...)
                </div>
            </div>

        </div>

    </main>

    <script>
        // Récupération des données envoyées par Django
        var dates = JSON.parse('{{ chart_dates|safe }}');
        var valuesUsers = JSON.parse('{{ chart_users|safe }}');

        // Configuration du Graphique ApexCharts
        var options = {
            series: [{
                name: "Utilisateurs Actifs",
                data: valuesUsers
            }],
            chart: {
                height: 350,
                type: 'area', // Type 'area' pour une zone colorée, ou 'line'
                toolbar: { show: false }
            },
            dataLabels: { enabled: false },
            stroke: { curve: 'smooth' },
            xaxis: {
                categories: dates,
            },
            colors: ['#4F46E5'] // Couleur Indigo
        };

        var chart = new ApexCharts(document.querySelector("#chart-users"), options);
        chart.render();
    </script>

</body>
</html>